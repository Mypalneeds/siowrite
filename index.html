<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIOWRITE â€” AI SEO Content Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --green: #00e5a0;
            --green-dim: #00b87a;
            --green-glow: rgba(0,229,160,0.15);
            --navy: #0b1628;
            --navy-mid: #101f38;
            --navy-card: #132240;
            --navy-border: #1e3460;
            --accent: #3b82f6;
            --text: #e2eaf8;
            --text-muted: #7a92b8;
            --red: #f87171;
            --yellow: #fbbf24;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background: var(--navy);
            color: var(--text);
            font-family: 'DM Sans', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse 600px 400px at 10% 20%, rgba(0,229,160,0.06) 0%, transparent 70%),
                radial-gradient(ellipse 500px 400px at 90% 80%, rgba(59,130,246,0.07) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 880px;
            margin: 0 auto;
            padding: 0 1.5rem;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            padding: 3.5rem 0 2.5rem;
            border-bottom: 1px solid var(--navy-border);
        }

        .logo-wrap {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .logo-icon {
            width: 36px; height: 36px;
            background: var(--green);
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Space Mono', monospace;
            font-weight: 700; font-size: 13px;
            color: var(--navy);
        }

        .logo-text {
            font-family: 'Space Mono', monospace;
            font-size: 1.75rem; font-weight: 700;
            color: #fff; letter-spacing: -0.5px;
        }

        .logo-text span { color: var(--green); }

        .tagline { color: var(--text-muted); font-size: 0.88rem; letter-spacing: 0.3px; }

        .contact-badge {
            display: inline-flex; align-items: center; gap: 0.4rem;
            margin-top: 1rem;
            background: var(--navy-card);
            border: 1px solid var(--navy-border);
            border-radius: 100px;
            padding: 0.35rem 1rem;
            font-size: 0.78rem;
            color: var(--text-muted);
        }

        .contact-badge a { color: var(--green); text-decoration: none; font-weight: 600; }
        .contact-badge a:hover { text-decoration: underline; }

        .card {
            background: var(--navy-card);
            border: 1px solid var(--navy-border);
            border-radius: 16px;
            padding: 1.75rem;
            margin-top: 2rem;
            transition: border-color 0.3s;
        }

        .card:hover { border-color: rgba(0,229,160,0.22); }

        .card-title {
            font-family: 'Space Mono', monospace;
            font-size: 0.66rem; letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--green);
            margin-bottom: 1.25rem;
            display: flex; align-items: center; gap: 0.5rem;
        }

        .card-title::after { content: ''; flex: 1; height: 1px; background: var(--navy-border); }

        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        @media (max-width: 600px) { .form-row { grid-template-columns: 1fr; } }

        .field { display: flex; flex-direction: column; gap: 0.4rem; margin-bottom: 1rem; }
        .field:last-child { margin-bottom: 0; }

        label { font-size: 0.82rem; font-weight: 600; color: var(--text-muted); letter-spacing: 0.3px; }

        input[type="text"],
        input[type="password"],
        select {
            background: var(--navy);
            border: 1px solid var(--navy-border);
            border-radius: 10px;
            color: var(--text);
            font-family: 'DM Sans', sans-serif;
            font-size: 0.92rem;
            padding: 0.7rem 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            outline: none;
            width: 100%;
        }

        input::placeholder { color: rgba(122,146,184,0.45); }

        input:focus, select:focus {
            border-color: var(--green);
            box-shadow: 0 0 0 3px var(--green-glow);
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%237a92b8' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            cursor: pointer;
        }

        select option { background: var(--navy-mid); }

        .provider-pills { display: flex; gap: 0.5rem; margin-bottom: 1.25rem; }

        .pill {
            padding: 0.4rem 1rem;
            border-radius: 100px;
            font-size: 0.82rem; font-weight: 600;
            cursor: pointer;
            border: 1px solid var(--navy-border);
            background: transparent;
            color: var(--text-muted);
            transition: all 0.2s;
            font-family: 'DM Sans', sans-serif;
        }

        .pill.active { background: var(--green); color: var(--navy); border-color: var(--green); }
        .pill:not(.active):hover { border-color: var(--green); color: var(--green); }

        .status-dot {
            width: 8px; height: 8px;
            border-radius: 50%; display: inline-block;
            background: var(--text-muted);
            margin-right: 0.4rem; transition: background 0.3s;
        }
        .status-dot.ready { background: var(--green); box-shadow: 0 0 6px var(--green); }
        .status-dot.error { background: var(--red); }

        .check-row { display: flex; align-items: center; gap: 0.5rem; margin-top: 0.75rem; }
        .check-row input[type="checkbox"] { width: 16px; height: 16px; accent-color: var(--green); cursor: pointer; }
        .check-row label { font-size: 0.82rem; cursor: pointer; color: var(--text-muted); }

        .hint { font-size: 0.78rem; color: var(--text-muted); margin-top: 0.5rem; line-height: 1.5; }
        .hint a { color: var(--green); text-decoration: none; }
        .hint a:hover { text-decoration: underline; }

        .error-box {
            background: rgba(248,113,113,0.08);
            border: 1px solid rgba(248,113,113,0.3);
            color: var(--red);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            font-size: 0.85rem;
            margin-top: 0.75rem;
            display: none;
        }
        .error-box.show { display: block; }

        .btn-generate {
            width: 100%; padding: 0.9rem;
            background: var(--green); color: var(--navy);
            border: none; border-radius: 12px;
            font-family: 'Space Mono', monospace;
            font-size: 0.88rem; font-weight: 700;
            letter-spacing: 1px; cursor: pointer;
            margin-top: 1.5rem; transition: all 0.2s;
            position: relative; overflow: hidden;
        }

        .btn-generate::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            transform: translateX(-100%); transition: transform 0.5s;
        }

        .btn-generate:hover:not(:disabled)::before { transform: translateX(100%); }
        .btn-generate:hover:not(:disabled) { background: var(--green-dim); transform: translateY(-1px); box-shadow: 0 8px 24px rgba(0,229,160,0.25); }
        .btn-generate:disabled { opacity: 0.5; cursor: not-allowed; }

        .loading-wrap { text-align: center; padding: 3rem; display: none; }
        .loading-wrap.show { display: block; }

        .loader {
            width: 40px; height: 40px;
            border: 2px solid var(--navy-border);
            border-top-color: var(--green);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-text { color: var(--text-muted); font-size: 0.9rem; }
        .loading-text strong { color: var(--green); }

        .output-wrap { display: none; }
        .output-wrap.show { display: block; }

        .output-field { margin-bottom: 1.25rem; }

        .output-label {
            font-size: 0.72rem; font-weight: 700;
            text-transform: uppercase; letter-spacing: 1.5px;
            color: var(--text-muted); margin-bottom: 0.4rem;
            display: flex; align-items: center; justify-content: space-between;
        }

        .badge {
            font-size: 0.7rem; letter-spacing: 0;
            text-transform: none; padding: 0.15rem 0.55rem;
            border-radius: 100px; background: var(--navy-border);
            color: var(--text-muted); font-weight: 600;
        }
        .badge.good { background: rgba(0,229,160,0.15); color: var(--green); }
        .badge.warn { background: rgba(251,191,36,0.15); color: var(--yellow); }
        .badge.over { background: rgba(248,113,113,0.15); color: var(--red); }

        /* Char meter bar */
        .meter-wrap { margin-top: 0.4rem; }
        .meter-bar-bg {
            height: 4px; border-radius: 100px;
            background: var(--navy-border);
            overflow: hidden;
        }
        .meter-bar-fill {
            height: 100%; border-radius: 100px;
            transition: width 0.4s, background 0.3s;
        }
        .meter-label {
            display: flex; justify-content: space-between;
            font-size: 0.72rem; margin-top: 0.3rem;
            color: var(--text-muted);
        }
        .meter-label.good { color: var(--green); }
        .meter-label.warn { color: var(--yellow); }
        .meter-label.over { color: var(--red); }

        .output-value {
            background: var(--navy);
            border: 1px solid var(--navy-border);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            font-size: 0.9rem; line-height: 1.7;
            color: var(--text);
            word-break: break-word;
        }

        .output-value.title-val { font-size: 1.05rem; font-weight: 600; color: #fff; }

        /* â”€â”€â”€ ARTICLE CONTENT AREA â”€â”€â”€ */
        .article-wrap {
            background: var(--navy);
            border: 1px solid var(--navy-border);
            border-radius: 12px;
            padding: 2rem 2.25rem;
            line-height: 1.9;
        }

        .article-wrap .art-h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            margin: 0 0 1.25rem 0;
            line-height: 1.3;
            border-bottom: 2px solid var(--green);
            padding-bottom: 0.75rem;
        }

        .article-wrap .art-h2 {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--green);
            margin: 2rem 0 0.65rem 0;
            line-height: 1.35;
        }

        .article-wrap .art-h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent);
            margin: 1.5rem 0 0.5rem 0;
            line-height: 1.35;
        }

        .article-wrap .art-h4 {
            font-size: 0.92rem;
            font-weight: 600;
            color: var(--text);
            margin: 1.25rem 0 0.4rem 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .article-wrap .art-p {
            font-size: 0.92rem;
            color: var(--text);
            margin: 0 0 1.1rem 0;
            line-height: 1.9;
        }

        .article-wrap .art-p:last-child { margin-bottom: 0; }

        .article-wrap ul, .article-wrap ol {
            margin: 0.5rem 0 1.1rem 1.5rem;
        }

        .article-wrap li {
            font-size: 0.92rem;
            color: var(--text);
            line-height: 1.8;
            margin-bottom: 0.3rem;
        }

        /* SEO checks */
        .kw-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(155px, 1fr));
            gap: 0.5rem; margin-top: 0.75rem;
        }

        .kw-check {
            background: var(--navy); border: 1px solid var(--navy-border);
            border-radius: 8px; padding: 0.5rem 0.75rem;
            font-size: 0.78rem;
            display: flex; align-items: center; gap: 0.4rem;
            color: var(--text-muted);
        }

        .kw-check.pass { border-color: rgba(0,229,160,0.35); color: var(--green); background: rgba(0,229,160,0.05); }
        .kw-check.fail { border-color: rgba(248,113,113,0.35); color: var(--red); background: rgba(248,113,113,0.05); }

        .seo-score-wrap {
            display: flex; align-items: center; gap: 1rem;
            background: var(--navy); border: 1px solid var(--navy-border);
            border-radius: 12px; padding: 1rem 1.25rem; margin-top: 1rem;
        }

        .score-circle {
            width: 58px; height: 58px; border-radius: 50%;
            background: conic-gradient(var(--green) calc(var(--pct) * 1%), var(--navy-border) 0);
            display: flex; align-items: center; justify-content: center;
            font-family: 'Space Mono', monospace;
            font-size: 0.82rem; font-weight: 700;
            color: var(--green); flex-shrink: 0; position: relative;
        }

        .score-circle::after {
            content: ''; position: absolute; inset: 6px;
            border-radius: 50%; background: var(--navy);
        }

        .score-num { position: relative; z-index: 1; }
        .score-label { font-size: 0.82rem; color: var(--text-muted); }
        .score-label strong { color: var(--text); font-size: 0.9rem; display: block; margin-bottom: 0.15rem; }

        .divider { height: 1px; background: var(--navy-border); margin: 1.25rem 0; }

        .action-row { display: flex; gap: 0.75rem; flex-wrap: wrap; margin-top: 1.5rem; }

        .btn-action {
            padding: 0.55rem 1.25rem;
            border-radius: 8px;
            font-family: 'DM Sans', sans-serif;
            font-size: 0.84rem; font-weight: 600;
            cursor: pointer; transition: all 0.2s;
            border: 1px solid var(--navy-border);
            background: transparent; color: var(--text-muted);
        }

        .btn-action:hover { border-color: var(--green); color: var(--green); background: var(--green-glow); }
        .btn-action.primary { background: var(--navy-border); color: var(--text); }
        .btn-action.danger:hover { border-color: var(--red); color: var(--red); background: rgba(248,113,113,0.07); }

        footer {
            text-align: center; padding: 2.5rem 0;
            color: var(--text-muted); font-size: 0.8rem;
            border-top: 1px solid var(--navy-border); margin-top: 3rem;
        }

        footer a { color: var(--green); text-decoration: none; }
    </style>
</head>
<body>

<header>
    <div class="container">
        <div class="logo-wrap">
            <div class="logo-icon">SW</div>
            <div class="logo-text">SIO<span>WRITE</span></div>
        </div>
        <div class="tagline">AI-Powered SEO Content Studio â€” Built for Results</div>
        <div class="contact-badge">
            ðŸ”‘ Need an API key? Contact: <a href="mailto:officialanalaize@gmail.com">officialanalaize@gmail.com</a>
        </div>
    </div>
</header>

<div class="container">

    <!-- â”€â”€ API CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="card">
        <div class="card-title">API Configuration</div>

        <div class="provider-pills">
            <button class="pill active" id="pill-groq" onclick="switchProvider('groq')">âš¡ Groq (Recommended)</button>
            <button class="pill" id="pill-hf" onclick="switchProvider('hf')">ðŸ¤— Hugging Face</button>
        </div>

        <div class="field">
            <label><span class="status-dot" id="statusDot"></span><span id="apiLabel">Groq API Key</span></label>
            <input type="password" id="apiKey" placeholder="gsk_..." autocomplete="off">
        </div>

        <div class="check-row">
            <input type="checkbox" id="rememberKey">
            <label for="rememberKey">Remember key in this browser</label>
        </div>

        <div class="hint" id="apiHint">
            Get a free key at <a href="https://console.groq.com/keys" target="_blank">console.groq.com/keys</a> â€” Sign up with Google or GitHub. Fast &amp; generous free limits.
        </div>

        <div class="error-box" id="errorBox"></div>
    </div>

    <!-- â”€â”€ CONTENT SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="card">
        <div class="card-title">Content Settings</div>

        <div class="field">
            <label>Topic / Subject</label>
            <input type="text" id="topic" placeholder="e.g. Benefits of Cloud Computing for Small Businesses...">
        </div>

        <div class="form-row">
            <div class="field">
                <label>Tone</label>
                <select id="tone">
                    <option value="professional">Professional</option>
                    <option value="casual">Casual &amp; Friendly</option>
                    <option value="informative">Informative</option>
                    <option value="persuasive">Persuasive</option>
                    <option value="authoritative">Authoritative</option>
                </select>
            </div>
            <div class="field">
                <label>Article Length</label>
                <select id="length">
                    <option value="short">Short (500â€“700 words)</option>
                    <option value="medium" selected>Medium (800â€“1200 words)</option>
                    <option value="long">Long (1500â€“2000 words)</option>
                </select>
            </div>
        </div>

        <button class="btn-generate" id="btnGenerate" onclick="generateArticle()">
            âœ¦ GENERATE SEO CONTENT
        </button>
    </div>

    <!-- â”€â”€ LOADING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="loading-wrap" id="loadingWrap">
        <div class="loader"></div>
        <div class="loading-text">Crafting your <strong>SEO-optimized content</strong>â€¦</div>
        <div class="hint" style="margin-top:0.5rem;text-align:center">Usually takes 5â€“20 seconds</div>
    </div>

    <!-- â”€â”€ OUTPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="output-wrap" id="outputWrap">

        <div class="card">
            <div class="card-title">Generated Content</div>

            <!-- Post Title -->
            <div class="output-field">
                <div class="output-label">Post Title</div>
                <div class="output-value title-val" id="outTitle"></div>
            </div>

            <!-- Meta Title + Meta Desc side by side -->
            <div class="form-row">
                <div class="output-field">
                    <div class="output-label">
                        Meta Title
                        <span class="badge" id="metaTitleBadge"></span>
                    </div>
                    <div class="output-value" id="outMetaTitle"></div>
                    <div class="meter-wrap" id="metaTitleMeter"></div>
                </div>
                <div class="output-field">
                    <div class="output-label">
                        Meta Description
                        <span class="badge" id="metaDescBadge"></span>
                    </div>
                    <div class="output-value" id="outMetaDesc"></div>
                    <div class="meter-wrap" id="metaDescMeter"></div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Excerpt -->
            <div class="output-field">
                <div class="output-label">Excerpt / Hook</div>
                <div class="output-value" id="outExcerpt"></div>
            </div>

            <!-- Keywords -->
            <div class="form-row">
                <div class="output-field">
                    <div class="output-label">Focus Keyword</div>
                    <div class="output-value" id="outFocusKw"></div>
                </div>
                <div class="output-field">
                    <div class="output-label">Secondary Keywords</div>
                    <div class="output-value" id="outSecKw"></div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Full Article -->
            <div class="output-field">
                <div class="output-label">Full Article Content</div>
                <div class="article-wrap" id="outContent"></div>
            </div>
        </div>

        <!-- â”€â”€ SEO AUDIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card">
            <div class="card-title">SEO Keyword Placement Audit</div>

            <div class="seo-score-wrap">
                <div class="score-circle" id="scoreCircle" style="--pct:0">
                    <span class="score-num" id="scoreNum">0%</span>
                </div>
                <div class="score-label">
                    <strong id="scoreLabel">SEO Score</strong>
                    Keyword placement across 5 critical zones
                </div>
            </div>

            <div class="kw-grid">
                <div class="kw-check" id="chk-title">â¬œ In Post Title</div>
                <div class="kw-check" id="chk-url">â¬œ In URL / Slug</div>
                <div class="kw-check" id="chk-first">â¬œ First Paragraph</div>
                <div class="kw-check" id="chk-headings">â¬œ In Headings</div>
                <div class="kw-check" id="chk-meta">â¬œ Meta Description</div>
            </div>

            <div class="output-field" style="margin-top:1.25rem">
                <div class="output-label">Suggested URL / Slug</div>
                <div class="output-value" id="outSlug" style="font-family:'Space Mono',monospace;font-size:0.82rem;color:var(--accent)"></div>
            </div>

            <div class="action-row">
                <button class="btn-action primary" onclick="copyAll(this)">ðŸ“‹ Copy All</button>
                <button class="btn-action" onclick="copyArticle(this)">Copy Article</button>
                <button class="btn-action" onclick="copyMeta(this)">Copy Meta</button>
                <button class="btn-action danger" onclick="clearAll()">âœ• Clear</button>
            </div>
        </div>

    </div>
</div>

<footer class="container">
    <strong style="color:var(--green);font-family:'Space Mono',monospace">SIOWRITE</strong> â€” AI SEO Content Studio &nbsp;Â·&nbsp;
    Contact: <a href="mailto:officialanalaize@gmail.com">officialanalaize@gmail.com</a>
</footer>

<script>
var apiKey     = '';
var provider   = 'groq';
var lastResult = null;

/* â”€â”€ META LENGTH RULES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var META_TITLE_MIN = 55;
var META_TITLE_MAX = 60;
var META_DESC_MIN  = 130;
var META_DESC_MAX  = 160;

window.addEventListener('load', loadSavedKey);

/* â”€â”€ PROVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function switchProvider(p) {
    provider = p;
    document.getElementById('pill-groq').className = 'pill' + (p === 'groq' ? ' active' : '');
    document.getElementById('pill-hf').className   = 'pill' + (p === 'hf'   ? ' active' : '');

    if (p === 'groq') {
        document.getElementById('apiLabel').textContent = 'Groq API Key';
        document.getElementById('apiKey').placeholder   = 'gsk_...';
        document.getElementById('apiHint').innerHTML    = 'Get a free key at <a href="https://console.groq.com/keys" target="_blank">console.groq.com/keys</a> â€” Sign up with Google or GitHub.';
    } else {
        document.getElementById('apiLabel').textContent = 'Hugging Face API Token';
        document.getElementById('apiKey').placeholder   = 'hf_...';
        document.getElementById('apiHint').innerHTML    = 'Get a free token at <a href="https://huggingface.co/settings/tokens" target="_blank">huggingface.co/settings/tokens</a> â€” Read permissions.';
    }
    loadSavedKey();
}

function loadSavedKey() {
    var saved = localStorage.getItem('siowrite_' + provider);
    if (saved) {
        document.getElementById('apiKey').value        = saved;
        document.getElementById('rememberKey').checked = true;
        apiKey = saved;
        dotState('ready');
    } else {
        document.getElementById('apiKey').value        = '';
        document.getElementById('rememberKey').checked = false;
        apiKey = '';
        dotState('');
    }
}

document.getElementById('apiKey').addEventListener('input', function () {
    apiKey = this.value.trim();
    dotState(apiKey ? 'ready' : '');
    hideError();
    if (document.getElementById('rememberKey').checked && apiKey) {
        localStorage.setItem('siowrite_' + provider, apiKey);
    }
});

document.getElementById('rememberKey').addEventListener('change', function () {
    if (this.checked && apiKey) localStorage.setItem('siowrite_' + provider, apiKey);
    else localStorage.removeItem('siowrite_' + provider);
});

function dotState(s) {
    var d = document.getElementById('statusDot');
    d.className = 'status-dot' + (s === 'ready' ? ' ready' : s === 'error' ? ' error' : '');
}

function showError(msg) {
    var b = document.getElementById('errorBox');
    b.textContent = '\u26a0 ' + msg;
    b.classList.add('show');
    dotState('error');
}

function hideError() { document.getElementById('errorBox').classList.remove('show'); }

/* â”€â”€ GENERATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function generateArticle() {
    var topic = document.getElementById('topic').value.trim();
    var tone  = document.getElementById('tone').value;
    var len   = document.getElementById('length').value;

    if (!topic)  { showError('Please enter a topic.'); return; }
    if (!apiKey) { showError('Please enter your API key first.'); return; }

    var btn = document.getElementById('btnGenerate');
    btn.disabled    = true;
    btn.textContent = '\u27f3 GENERATING\u2026';

    document.getElementById('loadingWrap').classList.add('show');
    document.getElementById('outputWrap').classList.remove('show');
    hideError();

    var lenMap = { short: '500-700 words', medium: '800-1200 words', long: '1500-2000 words' };

    try {
        var rawText = provider === 'groq'
            ? await callGroq(topic, tone, lenMap[len])
            : await callHF(topic, tone, lenMap[len]);

        var parsed = smartParse(rawText, topic);

        /* â”€â”€ ENFORCE meta lengths server-side if model cheated â”€â”€ */
        parsed.meta_title       = enforceLength(parsed.meta_title,       META_TITLE_MIN, META_TITLE_MAX);
        parsed.meta_description = enforceLength(parsed.meta_description, META_DESC_MIN,  META_DESC_MAX);

        lastResult = parsed;
        renderOutput(parsed);

    } catch (err) {
        showError(err.message);
        console.error(err);
    } finally {
        document.getElementById('loadingWrap').classList.remove('show');
        btn.disabled    = false;
        btn.textContent = '\u2726 GENERATE SEO CONTENT';
    }
}

/* â”€â”€ ENFORCE LENGTH: trims or pads to fit target range â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function enforceLength(str, min, max) {
    if (!str) return str;
    str = str.trim();

    /* Too long: trim at last space before max */
    if (str.length > max) {
        var trimmed = str.substring(0, max);
        var lastSpace = trimmed.lastIndexOf(' ');
        str = (lastSpace > max - 15) ? trimmed.substring(0, lastSpace).trim() : trimmed.trim();
        /* Add ellipsis only if still short of min after trim */
        if (str.length < min) str = str + 'â€¦';
    }

    /* Still too short: we note it but return as-is â€” the meter will show warning */
    return str;
}

/* â”€â”€ API CALLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function callGroq(topic, tone, lenTarget) {
    var resp = await fetch('https://api.groq.com/openai/v1/chat/completions', {
        method: 'POST',
        headers: { 'Authorization': 'Bearer ' + apiKey, 'Content-Type': 'application/json' },
        body: JSON.stringify({
            model: 'llama-3.3-70b-versatile',
            messages: [
                {
                    role: 'system',
                    content: 'You are an elite SEO content writer. You ONLY output a raw JSON object. No markdown. No code fences. No extra text whatsoever â€” just the JSON.'
                },
                { role: 'user', content: buildPrompt(topic, tone, lenTarget) }
            ],
            temperature: 0.7,
            max_tokens: 4000
        })
    });

    if (!resp.ok) {
        var e = await resp.json().catch(function () { return {}; });
        if (resp.status === 401) throw new Error('Invalid API key. Please check your Groq key.');
        if (resp.status === 429) throw new Error('Rate limit reached. Wait a moment and try again.');
        throw new Error((e.error && e.error.message) || ('Groq API error ' + resp.status));
    }

    var data = await resp.json();
    return data.choices[0].message.content;
}

async function callHF(topic, tone, lenTarget) {
    var resp = await fetch('https://api-inference.huggingface.co/models/google/flan-t5-xxl', {
        method: 'POST',
        headers: { 'Authorization': 'Bearer ' + apiKey, 'Content-Type': 'application/json' },
        body: JSON.stringify({
            inputs: buildPrompt(topic, tone, lenTarget),
            parameters: { max_new_tokens: 2000, temperature: 0.7 },
            options: { wait_for_model: true }
        })
    });

    if (!resp.ok) {
        var e = await resp.json().catch(function () { return {}; });
        if (resp.status === 401) throw new Error('Invalid Hugging Face token.');
        if (resp.status === 503) throw new Error('Model loading. Wait 20 seconds and try again.');
        throw new Error(e.error || ('HuggingFace API error ' + resp.status));
    }

    var data = await resp.json();
    if (Array.isArray(data) && data[0] && data[0].generated_text) return data[0].generated_text;
    if (data.generated_text) return data.generated_text;
    throw new Error('Unexpected response format from Hugging Face.');
}

/* â”€â”€ PROMPT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildPrompt(topic, tone, lenTarget) {
    return 'You are a professional SEO content writer. Output ONLY a single raw JSON object â€” absolutely no markdown, no code fences, no text outside the JSON.\n\n'
        + 'TOPIC: "' + topic + '"\n'
        + 'TONE: ' + tone + '\n'
        + 'LENGTH: ' + lenTarget + '\n\n'
        + 'STRICT RULES â€” violating any rule makes the output useless:\n'
        + '1. meta_title: MUST be between 55 and 60 characters exactly. Count every character including spaces. No exceptions.\n'
        + '2. meta_description: MUST be between 130 and 160 characters exactly. Count every character. No exceptions.\n'
        + '3. The focus_keyword MUST appear in: post_title, first paragraph of content, at least two ## headings, meta_description, and meta_title.\n'
        + '4. url_slug: derived from focus_keyword â€” lowercase, hyphens only, no special characters.\n'
        + '5. content: Write the FULL article using this EXACT heading structure:\n'
        + '   # H1 â€” the main article title (focus keyword in it)\n'
        + '   ## H2 â€” major section headings (at least 4 of them)\n'
        + '   ### H3 â€” subsection headings under H2s (at least 2 per H2)\n'
        + '   #### H4 â€” optional deeper subsections\n'
        + '   Write 2-4 full paragraphs of text under every H2 section.\n'
        + '   Every paragraph must be 3-5 sentences long.\n'
        + '   Separate sections clearly. Do NOT use asterisks for bold â€” just plain text in content.\n'
        + '6. excerpt: A compelling 2-sentence hook (separate from article body).\n'
        + '7. secondary_keywords: 4-6 related keywords, comma-separated.\n\n'
        + 'Output ONLY this exact JSON:\n'
        + '{"post_title":"...","meta_title":"...","meta_description":"...","excerpt":"...","focus_keyword":"...","secondary_keywords":"...","url_slug":"...","content":"..."}';
}

/* â”€â”€ SMART JSON PARSER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function smartParse(raw, topic) {
    var s = raw.replace(/^```(?:json)?\s*/i, '').replace(/\s*```\s*$/, '').trim();

    /* Pass 1: direct */
    try {
        var o = JSON.parse(s);
        if (o && o.post_title) return fixFields(o);
    } catch (e) {}

    /* Pass 2: outermost { } */
    var a = s.indexOf('{');
    var b = s.lastIndexOf('}');
    if (a !== -1 && b > a) {
        var chunk = s.substring(a, b + 1);

        try {
            var o2 = JSON.parse(chunk);
            if (o2 && o2.post_title) return fixFields(o2);
        } catch (e) {}

        /* Pass 3: fix literal newlines inside string values */
        var fixed = '';
        var inStr = false, esc = false;
        for (var i = 0; i < chunk.length; i++) {
            var ch = chunk[i];
            if (esc) { fixed += ch; esc = false; continue; }
            if (ch === '\\') { esc = true; fixed += ch; continue; }
            if (ch === '"') { inStr = !inStr; fixed += ch; continue; }
            if (inStr && (ch === '\n' || ch === '\r')) { fixed += '\\n'; continue; }
            fixed += ch;
        }
        try {
            var o3 = JSON.parse(fixed);
            if (o3 && o3.post_title) return fixFields(o3);
        } catch (e) {}
    }

    /* Pass 4: regex field grab */
    function grab(field) {
        var rx = new RegExp('"' + field + '"\\s*:\\s*"((?:[^"\\\\]|\\\\.)*)"');
        var m  = s.match(rx);
        if (!m) return '';
        return m[1].replace(/\\n/g, '\n').replace(/\\"/g, '"').replace(/\\\\/g, '\\');
    }

    return fixFields({
        post_title:         grab('post_title')         || topic,
        meta_title:         grab('meta_title')         || topic.slice(0, 60),
        meta_description:   grab('meta_description')   || '',
        excerpt:            grab('excerpt')            || '',
        focus_keyword:      grab('focus_keyword')      || topic.split(' ').slice(0, 3).join(' '),
        secondary_keywords: grab('secondary_keywords') || '',
        url_slug:           grab('url_slug')           || slugify(topic),
        content:            grab('content')            || s
    });
}

function fixFields(obj) {
    /* Unwrap nested JSON in content */
    var c = (obj.content || '').trim();
    if (c.charAt(0) === '{') {
        try {
            var inner = JSON.parse(c);
            if (inner && inner.content) {
                obj.post_title         = obj.post_title         || inner.post_title;
                obj.meta_title         = obj.meta_title         || inner.meta_title;
                obj.meta_description   = obj.meta_description   || inner.meta_description;
                obj.excerpt            = obj.excerpt            || inner.excerpt;
                obj.focus_keyword      = obj.focus_keyword      || inner.focus_keyword;
                obj.secondary_keywords = obj.secondary_keywords || inner.secondary_keywords;
                obj.url_slug           = obj.url_slug           || inner.url_slug;
                obj.content            = inner.content;
            }
        } catch (e) {}
    }

    ['post_title','meta_title','meta_description','excerpt','focus_keyword','secondary_keywords','url_slug'].forEach(function (k) {
        if (obj[k]) obj[k] = String(obj[k]).replace(/\\n/g, ' ').replace(/\\"/g, '"').trim();
    });

    return obj;
}

/* â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderOutput(d) {
    setText('outTitle',   d.post_title         || '');
    setText('outMetaTitle', d.meta_title       || '');
    setText('outMetaDesc',  d.meta_description || '');
    setText('outExcerpt',   d.excerpt          || '');
    setText('outFocusKw',   d.focus_keyword    || '');
    setText('outSecKw',     d.secondary_keywords || '');

    renderArticle(d.content || '');

    var slug = d.url_slug || slugify(d.post_title || '');
    setText('outSlug', '/' + slug);

    /* Meters */
    renderMeter('metaTitleMeter', 'metaTitleBadge', (d.meta_title||'').length, META_TITLE_MIN, META_TITLE_MAX, '55â€“60 chars');
    renderMeter('metaDescMeter',  'metaDescBadge',  (d.meta_description||'').length, META_DESC_MIN, META_DESC_MAX, '130â€“160 chars');

    /* SEO checks */
    var fk      = (d.focus_keyword || '').toLowerCase();
    var content = d.content || '';

    var chkMap = {
        'chk-title':    (d.post_title||'').toLowerCase().indexOf(fk) !== -1,
        'chk-url':      slug.indexOf(fk.replace(/\s+/g, '-')) !== -1,
        'chk-first':    getFirstPara(content).toLowerCase().indexOf(fk) !== -1,
        'chk-headings': getHeadings(content).some(function (h) { return h.toLowerCase().indexOf(fk) !== -1; }),
        'chk-meta':     (d.meta_description||'').toLowerCase().indexOf(fk) !== -1
    };

    var lblMap = {
        'chk-title': 'In Post Title', 'chk-url': 'In URL / Slug',
        'chk-first': 'First Paragraph', 'chk-headings': 'In Headings', 'chk-meta': 'Meta Description'
    };

    var passed = 0;
    Object.keys(chkMap).forEach(function (id) {
        var ok = chkMap[id];
        var el = document.getElementById(id);
        el.className  = 'kw-check ' + (ok ? 'pass' : 'fail');
        el.textContent = (ok ? '\u2713 ' : '\u2715 ') + lblMap[id];
        if (ok) passed++;
    });

    var pct = Math.round((passed / 5) * 100);
    document.getElementById('scoreNum').textContent = pct + '%';
    document.getElementById('scoreCircle').style.setProperty('--pct', pct);
    var lbl = pct >= 80 ? '\uD83D\uDFE2 Excellent SEO Score' : pct >= 60 ? '\uD83D\uDFE1 Good SEO Score' : '\uD83D\uDD34 Needs Improvement';
    document.getElementById('scoreLabel').textContent = lbl;

    document.getElementById('outputWrap').classList.add('show');
    setTimeout(function () {
        document.getElementById('outputWrap').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
}

/* â”€â”€ METER BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderMeter(meterId, badgeId, len, min, max, label) {
    var state = len >= min && len <= max ? 'good' : (len > max ? 'over' : 'warn');
    var fillPct = Math.min(100, Math.round((len / max) * 100));
    var fillColor = state === 'good' ? '#00e5a0' : state === 'over' ? '#f87171' : '#fbbf24';

    var badgeEl = document.getElementById(badgeId);
    badgeEl.textContent = len + ' / ' + max;
    badgeEl.className   = 'badge ' + state;

    var meterEl = document.getElementById(meterId);
    meterEl.innerHTML =
        '<div class="meter-bar-bg"><div class="meter-bar-fill" style="width:' + fillPct + '%;background:' + fillColor + '"></div></div>'
        + '<div class="meter-label ' + state + '">'
        + '<span>' + (state === 'good' ? 'âœ“ Perfect range' : state === 'over' ? 'âœ• Too long â€” trimmed to fit' : 'âš  Slightly short') + '</span>'
        + '<span>' + len + ' chars &nbsp;|&nbsp; Target: ' + label + '</span>'
        + '</div>';
}

/* â”€â”€ ARTICLE RENDERER: markdown â†’ semantic HTML â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderArticle(raw) {
    var el = document.getElementById('outContent');
    var lines = raw.split('\n');
    var html  = '';

    for (var i = 0; i < lines.length; i++) {
        var line = lines[i];

        /* Headings */
        if (/^#### /.test(line)) {
            html += '<div class="art-h4">' + esc(line.replace(/^#### /, '')) + '</div>';
            continue;
        }
        if (/^### /.test(line)) {
            html += '<div class="art-h3">' + esc(line.replace(/^### /, '')) + '</div>';
            continue;
        }
        if (/^## /.test(line)) {
            html += '<div class="art-h2">' + esc(line.replace(/^## /, '')) + '</div>';
            continue;
        }
        if (/^# /.test(line)) {
            html += '<div class="art-h1">' + esc(line.replace(/^# /, '')) + '</div>';
            continue;
        }

        /* Skip blank lines between blocks â€” spacing handled by CSS margins */
        if (line.trim() === '') continue;

        /* Regular paragraph text */
        html += '<p class="art-p">' + esc(line.trim()) + '</p>';
    }

    el.innerHTML = html || '<p class="art-p">No content generated.</p>';
}

/* â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function esc(str) {
    return str
        .replace(/&/g,  '&amp;')
        .replace(/</g,  '&lt;')
        .replace(/>/g,  '&gt;')
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
}

function setText(id, val) { document.getElementById(id).textContent = val; }

function slugify(str) {
    return str.toLowerCase().replace(/[^a-z0-9\s]/g, '').trim().replace(/\s+/g, '-');
}

function getFirstPara(content) {
    var lines = content.split('\n');
    for (var i = 0; i < lines.length; i++) {
        var l = lines[i].trim();
        if (l && l.charAt(0) !== '#') return l;
    }
    return '';
}

function getHeadings(content) {
    return content.split('\n')
        .filter(function (l) { return /^#{1,4} /.test(l.trim()); })
        .map(function (l) { return l.replace(/^#{1,4} /, ''); });
}

/* â”€â”€ COPY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function copyAll(btn) {
    if (!lastResult) return;
    var lines = [
        'POST TITLE:\n'         + (lastResult.post_title         || ''),
        'META TITLE:\n'         + (lastResult.meta_title         || ''),
        'META DESCRIPTION:\n'   + (lastResult.meta_description   || ''),
        'EXCERPT:\n'            + (lastResult.excerpt            || ''),
        'FOCUS KEYWORD:\n'      + (lastResult.focus_keyword      || ''),
        'SECONDARY KEYWORDS:\n' + (lastResult.secondary_keywords || ''),
        'URL SLUG:\n/'          + (lastResult.url_slug           || ''),
        '\n--- FULL ARTICLE ---\n' + (lastResult.content         || '')
    ];
    toClipboard(lines.join('\n\n'));
    flash(btn, '\u2714 Copied!');
}

function copyArticle(btn) {
    if (!lastResult) return;
    toClipboard(lastResult.content || '');
    flash(btn, '\u2714 Copied!');
}

function copyMeta(btn) {
    if (!lastResult) return;
    toClipboard('Meta Title: ' + (lastResult.meta_title||'') + '\nMeta Description: ' + (lastResult.meta_description||''));
    flash(btn, '\u2714 Copied!');
}

function toClipboard(text) {
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).catch(function () { fallbackCopy(text); });
    } else { fallbackCopy(text); }
}

function fallbackCopy(text) {
    var ta = document.createElement('textarea');
    ta.value = text;
    ta.style.cssText = 'position:fixed;opacity:0;top:0;left:0;';
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
}

function flash(btn, msg) {
    if (!btn) return;
    var orig = btn.textContent;
    btn.textContent = msg;
    setTimeout(function () { btn.textContent = orig; }, 1800);
}

function clearAll() {
    document.getElementById('outputWrap').classList.remove('show');
    document.getElementById('topic').value = '';
    lastResult = null;
}

document.getElementById('topic').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') generateArticle();
});
</script>
</body>
</html>
